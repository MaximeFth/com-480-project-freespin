<!DOCTYPE html>
<html>
<!-- Source for the sankey diagram inspiration code : https://www.d3-graph-gallery.com/graph/sankey_basic.html -->
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="author" content="Jeanmonod Xavier, Fellrath Maxime, Yura Tak">
  <meta name="description" content="NBA visualisation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- load scripts for nice select; source : https://hernansartorio.com/jquery-nice-select/ -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.css" rel="stylesheet" />
  <!-- load sanskey diagram -->
  <script type="text/javascript" SameSite=None src="https://www.gstatic.com/charts/loader.js"></script>
  <script src = "sanskey.js"></script>



  <link href="style.css" rel="stylesheet">
</head>

<body>
  <!-- yellow handband -->
  <div id="headBand"></div>

  <div id ="title">
    <ul>
      <font size = "4">
       <li><a class="menuButtons" href="index.html">Home</a></li>
       <li><a class="menuButtons" href="sankeyDiagram.html">Sankey Diagrams</a></li>
       <li><a class="menuButtons" href="map.html">USA Map</a></li>
     </font>
   </ul>
 </div>
 <div id="content">
  <!-- div for the sanskey diagram -->
  <div id ="sankeyVisu">
  </div>
  <!-- div for the selection of teams and seasons -->
  <div id="features">
    <font size="5">
      <form name="playerName" onSubmit="return readTeamsAndYear()">

        <label for="team-select"></label>

        <select name="Teams" id="teamSelect">
          <option value="">--Select a Team--</option>

          <option value="PHX">Phoenix Suns</option>
          <option value="GSW">Golden State Warriors</option>
          <option value="LAC">Los Angeles Clippers</option>
          <option value="LAL">Los Angeles Lakers</option>
          <option value="SAC">Sacramento Kings</option>
          <option value="DEN">Denver Nuggets</option>
          <option value="MIA">Miami Heat</option>
          <option value="ORL">Orlando Magic</option>
          <option value="ATL">Atlanta Hawks</option>
          <option value="CHI">Chicago Bulls</option>
          <option value="IND">Indiana Pacers</option>
          <option value="NOP">New Orleans Pelicans</option>
          <option value="BOS">Boston Celtics</option>
          <option value="DET">Detroit Pistons</option>
          <option value="MIN">Minnesota Timberwolves</option>
          <option value="BKN">Brooklyn Nets</option>
          <option value="NYK">New York Knicks</option>
          <option value="CHA">Charlotte Hornets</option>
          <option value="CLE">Cleveland Cavaliers</option>
          <option value="OKC">Oklahoma City Thunder</option>
          <option value="POR">Portland Trail Blazers</option>
          <option value="PHI">Philadelphia 76ers</option>
          <option value="MEM">Memphis Grizzlies</option>
          <option value="DAL">Dallas Mavericks</option>
          <option value="HOU">Houston Rockets</option>
          <option value="SAS">San Antonio Spurs</option>
          <option value="UTA">Utah Jazz</option>
          <option value="MIL">Milwaukee Bucks</option>
          <option value="WAS">Washington Wizards</option>
        </select>
        <br>
        <label for="season"></label>

        <select name="Season" id="seasonSelect">
          <option value="">--Select a season--</option>
          <option value="1980">1980</option>
          <option value="1981">1981</option>
          <option value="1982">1982</option>
          <option value="1983">1983</option>
          <option value="1984">1984</option>
          <option value="1985">1985</option>
          <option value="1986">1986</option>
          <option value="1987">1987</option>
          <option value="1988">1988</option>
          <option value="1989">1989</option>
          <option value="1990">1990</option>        
          <option value="1991">1991</option>
          <option value="1992">1992</option>
          <option value="1993">1993</option>
          <option value="1994">1994</option>
          <option value="1995">1995</option>
          <option value="1996">1996</option>
          <option value="1997">1997</option>
          <option value="1998">1998</option>
          <option value="1999">1999</option>
          <option value="2000">2000</option>
          <option value="2001">2001</option>
          <option value="2002">2002</option>
          <option value="2003">2003</option>
          <option value="2004">2004</option>
          <option value="2005">2005</option>
          <option value="2006">2006</option>
          <option value="2007">2007</option>
          <option value="2008">2008</option>
          <option value="2009">2009</option>
          <option value="2010">2010</option>
          <option value="2011">2011</option>
          <option value="2012">2012</option>
          <option value="2013">2013</option>
          <option value="2014">2014</option>
          <option value="2015">2015</option>
          <option value="2016">2016</option>
          <option value="2017">2017</option>
          <input name="Submit" class = "submit" type="submit" value="Submit" >
        </form>
      </select>


      <br>
      <br>


    </font>





    <div id = "playersBox">
      <form id="players_selected", name= "playerSelection", onSubmit = "return readPlayers()">

      </form>
    </div>
    <div id = "selectedPlayersBuffer">
      <h1> Statistics</h1>


      <input type="checkbox" name = "selectedStat"  id="G"  value=G>
      <font size =5><label for="G">Games</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="GS"  value=GS>
      <font size =5><label for="GS">Game started</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="PER"  value=PER>
      <font size =5><label for="PER">Player efficiency rating</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="FTr"  value=FTr>
      <font size =5><label for="FTr">Free throw Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="ORB%"  value=ORB%>
      <font size =5><label for="ORB%">Offensive rebound rate</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="DRB%"  value=DRB%>
      <font size =5><label for="DRB%">Defensive Rebound rate</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="AST%"  value=AST%>
      <font size =5><label for="AST%">Assist Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="STL%"  value=STL%>
      <font size =5><label for="STL%">Steal Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="BLK%"  value=BLK%>
      <font size =5><label for="BLK%">Block Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="TOV%"  value=TOV%>
      <font size =5><label for="TOV%">Turnover Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="USG%"  value=USG%>
      <font size =5><label for="USG%">Usage Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="3P"  value=3P>
      <font size =5><label for="3P">3Pts</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="3PA"  value=3PA>
      <font size =5><label for="3PA">3Pts attempts</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="3P%"  value=3P%>
      <font size =5><label for="3P%">3Pts Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="2P"  value=2P>
      <font size =5><label for="2P">2Pts</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="2PA"  value=2PA>
      <font size =5><label for="2PA">2Pts attempts</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="2P%"  value=2P%>
      <font size =5><label for="2P%">2Pts percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="FT"  value=FT>
      <font size =5><label for="FT">Free throws</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="FTA"  value=FTA>
      <font size =5><label for="FTA">Free throws attempts</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="FT%"  value=FT%>
      <font size =5><label for="FT%">Free throws Percentage</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="ORB"  value=ORB>
      <font size =5><label for="ORB">Offensive rebounds</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="DRB"  value=DRB>
      <font size =5><label for="DRB">Defensive rebounds</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="AST"  value=AST>
      <font size =5><label for="AST">Assists</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="STL"  value=STL>
      <font size =5><label for="STL">Steals</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="BLK"  value=BLK>
      <font size =5><label for="BLK">Blocks</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="TOV"  value=TOV>
      <font size =5><label for="TOV">Turnovers</label></font><br>
      <input type="checkbox" name = "selectedStat"  id="PTS"  value=PTS>
      <font size =5><label for="PTS">Points</label></font><br>

    </div>
  </div>
</div>





<script>



        // function to get the team after selection and put in in playerBox
        function readTeamsAndYear(event){
          var year = document.getElementById("seasonSelect").value.toUpperCase();
          var tm = document.getElementById("teamSelect").value.toUpperCase();
          var players = [];
          console.log("DATA/players_teams_seasons/"+tm+year+".csv");
          d3.csv("DATA/players_teams_seasons/"+tm+year+".csv").then (function(data) {

            for (var i = 0; i < data.length; i++) {
              players.push(data[i].Player);
            };
            document.getElementById('players_selected').innerHTML = "";
            (listToBoxes(players));
            return false;
          });
          return false;
        }; 

  //make the nice selections boxes instead of ordinary ones. select by id
  $('#seasonSelect').niceSelect();
  $('#teamSelect').niceSelect();


  function listToBoxes(mylist){
    for (var i = 0; i < mylist.length; i++) {
      document.getElementById('players_selected').innerHTML += "\n";

      document.getElementById('players_selected').innerHTML += "<input type=\"checkbox\"name = selectedPlayers  id=\"players"+i+"\"  value="+(mylist[i]+'').replace(/ /g,"_")+"> ";
      document.getElementById('players_selected').innerHTML += "\n";
      document.getElementById('players_selected').innerHTML += "<font size =5><label for=\"players"+i+"\">"+mylist[i]+"</label></font><br>";

    };
    document.getElementById('players_selected').innerHTML += "<button class=\"submit\" type = \"submit\">Submit</button>";
    return 0;
  };

  function readPlayers(event){
    var checkboxesPlayers = document.getElementsByName('selectedPlayers');
    var checkboxesStats = document.getElementsByName('selectedStat');

    var indexes = [];
    var selectedPlayers = [];
    var StatsList = [];
    for (var checkboxS of checkboxesStats) {
      if (checkboxS.checked){
        StatsList.push((checkboxS.value+''));

      }};
      console.log(StatsList);
      for (var checkboxP of checkboxesPlayers) {
        if (checkboxP.checked){
          selectedPlayers.push((checkboxP.value+'').replace("_"," "));

        }};
      var stats = [StatsList];

        var year = document.getElementById("seasonSelect").value.toUpperCase();
        var tm = document.getElementById("teamSelect").value.toUpperCase();
        var players = [];
        d3.csv("DATA/players_teams_seasons/"+tm+year+".csv").then (function(data) {
          for (var i = 0; i < data.length; i++) {

            for (var j = 0; j<selectedPlayers.length; j++) {
              var temp = [];
                if (selectedPlayers[j] == data[i].Player) {
                  for(var k of StatsList){
                    
                    temp.push(Number(data[i][k]));
                };
                stats.push(temp);

              };
            };


          };
          console.log(stats);
          updateDiagram(selectedPlayers, stats);
          return false;
        });
        return false;

      };





      function  updateDiagram(selectedPlayers,s){
       playersList = selectedPlayers;
       stats = s;

       drawChart();

       return false;
     };


     </script>

   </body>

   </html>